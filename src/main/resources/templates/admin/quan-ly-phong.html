<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="layout/layout :: layout(~{::body})">
<body>
<section id="quan-ly-phong" class="py-4">
    <div class="container-fluid">
        <div class="page-title text-center mb-4">
            <h1 class="fw-bold"><i class="bi bi-house me-2"></i>QUẢN LÝ PHÒNG</h1>
        </div>

        <div class="row">
            <div class="col-md-3" th:replace="fragments/sidebar-admin :: sidebar-admin"></div>
            <div class="content-wrapper">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold">Danh sách phòng</h2>
                    <button class="btn btn-primary btn-custom" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        <i class="bi bi-plus-circle me-2"></i>Thêm phòng mới
                    </button>
                </div>

                <!-- Room Statistics -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <i class="bi bi-house display-6 mb-2"></i>
                                <h4 class="fw-bold">25</h4>
                                <p class="mb-0">Tổng phòng</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card-green">
                            <div class="card-body text-center">
                                <i class="bi bi-check-circle display-6 mb-2"></i>
                                <h4 class="fw-bold">18</h4>
                                <p class="mb-0">Phòng trống</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card-orange">
                            <div class="card-body text-center">
                                <i class="bi bi-person-fill display-6 mb-2"></i>
                                <h4 class="fw-bold">5</h4>
                                <p class="mb-0">Đã thuê</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card-purple">
                            <div class="card-body text-center">
                                <i class="bi bi-tools display-6 mb-2"></i>
                                <h4 class="fw-bold">2</h4>
                                <p class="mb-0">Bảo trì</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room Table -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <div id="content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm phòng</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="numberRoom">Số phòng:</label>
                        <input type="text" name="numberRoom" id="numberRoom" class="form-control"
                               placeholder="Số phòng">
                    </div>
                    <div class="mb-3">
                        <label for="type">Loại phòng: </label>
                        <select class="form-select" aria-label="Default select example" id="type">
                            <option value="Phòng thường">Phòng thường</option>
                            <option value="Phòng vip">Phòng vip</option>
                            <option value="Phòng tổng thống">Phòng tổng thống</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="price">Giá: </label>
                        <input type="number" name="price" id="price" class="form-control" placeholder="price">
                    </div>
                    <div class="mb-3">
                        <label for="status">Trạng thái: </label>
                        <input type="radio" name="status" id="status" class="" value="0">Phòng trống
                        <input type="radio" name="status" id="status" class="" value="1">Phòng đang bảo trì
                    </div>
                    <div class="mb-3">
                        <label for="description">Mô tả: </label>
                        <textarea class="form-control" placeholder="Mô tả" id="description" name="description"
                                  style="height: 100px"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="btnSave">Xác nhận</button>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="//cdn.datatables.net/2.3.4/js/dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function loadRoom() {
        $.ajax({
            type: "GET",
            url: '/admin/rooms/get-rooms',
            success: function (rooms) {
                let html = '<table id="myTable" border="1" cellspacing="0" cellpadding="5" class="table"><thead>\n' +
                    '    <tr>\n' +
                    '        <th scope="col">Số phòng</th>\n' +
                    '        <th scope="col">Kiểu phòng</th>\n' +
                    '        <th scope="col">Giá</th>\n' +
                    '        <th scope="col">Trạng thái</th>\n' +
                    '        <th scope="col">Mô tả</th>\n' +
                    '        <th scope="col">Update</th>\n' +
                    '        <th scope="col">Delete</th>\n' +
                    '    </tr>\n' +
                    '    </thead><tbody>';
                rooms.forEach(function (r) {
                    html += `<tr>
                            <td >${r.numberRoom}</td>
                            <td>${r.typeRoom}</td>
                            <td>${r.price}</td>
                            <td>${r.statusRoom == 1 ? 'Đã thuê' : r.status == 2?'Bảo trì':'Phòng trống'}</td>
                            <td>${r.description}</td>
                            <td><button class="btn btn-primary" id="modalUpdate" onclick="showUpdateModal(${r.id})">Update</button></td>
                            <td><button class="btn btn-primary" id="delete" onclick="showDelete(${r.id})" >Delete</button></td>
                         </tr>`;
                })
                html += '</tbody></table>';
                $("#content").html(html);
                let table = new DataTable('#myTable');
            }
        })
    }

    $("#btnSave").click(function () {
        const myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {})
        const numberRoom = $("#numberRoom").val();
        const type = $("#type").val();
        const price = $("#price").val();
        const status = $("#status").val();
        const description = $("#description").val();
        console.log(numberRoom, type, price, status, description);
        $.ajax({
            type: "POST",
            url: "/admin/rooms/add-room",
            data: JSON.stringify({numberRoom: numberRoom, typeRoom: type, price: price, statusRoom: status, description: description}),
            contentType: "application/json",
            success: function () {
                Swal.fire({
                    title: 'Succuss!',
                    text: 'Tao moi thanh cong',
                    icon: 'success',
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                        myModal.hide();
                        loadStudent();
                    }
                });
                // location.reload();
            },
            error: function () {
                Swal.fire({
                    title: 'Error!',
                    text: 'Có lỗi sảy ra',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        })
    })

    function showDelete(id) {
        Swal.fire({
            title: "Bạn có muốn xoá không?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Có"
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: "DELETE",
                    url: `/admin/rooms/delete-room/${id}`,
                    success: function () {
                        Swal.fire({
                            title: "Xoá thành công!",
                            icon: "success"
                        }).then((result) => {
                            loadStudent();
                        });
                    },
                    error: function () {
                        alert("Co loi xay ra");
                    }
                })

            }
        });
    }

    loadRoom();
</script>
</body>
