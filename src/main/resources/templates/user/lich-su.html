<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="layout/layout :: layout(~{::body})">
<body>
<section id="lich-su" class="py-4">
    <div class="container-fluid">
        <div class="page-title text-center mb-4">
            <h1 class="fw-bold"><i class="bi bi-calendar-plus me-2"></i>LỊCH SỬ ĐẶT PHÒNG</h1>
        </div>

        <div class="row">
            <div class="col-md-3" th:replace="fragments/sidebar-user :: sidebar-user"></div>
            <div class="col-md-9 mt-3">
                <!-- Lịch sử đặt phòng -->
                <div class="container my-5">
                    <div class="card shadow-lg border-0 rounded-4">
<!--                        <div class="card-header bg-primary text-white py-3 rounded-top-4">-->
<!--                            <h4 class="mb-0">-->
<!--                                <i class="bi bi-clock-history me-2"></i> Lịch sử đặt phòng-->
<!--                            </h4>-->
<!--                        </div>-->

                        <div class="card-body p-4">
                            <div class="table-responsive" id="content">
<!--                                <table id="bookingHistoryTable" class="table table-hover align-middle">-->
<!--                                    <thead class="table-light">-->
<!--                                    <tr class="text-center">-->
<!--                                        <th>Mã đặt</th>-->
<!--                                        <th>Phòng</th>-->
<!--                                        <th>Check-in</th>-->
<!--                                        <th>Check-out</th>-->
<!--                                        <th>Số đêm</th>-->
<!--                                        <th>Tổng tiền</th>-->
<!--                                        <th>Thao tác</th>-->
<!--                                    </tr>-->
<!--                                    </thead>-->
<!--                                    <tbody >-->
<!--                                    &lt;!&ndash; Dữ liệu sẽ được load bằng Ajax &ndash;&gt;-->
<!--                                    </tbody>-->
<!--                                </table>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-4" id="loadData">
            </div>

        </div>
    </div>


</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="//cdn.datatables.net/2.3.4/js/dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>
<script>
    function loadData() {
        $.ajax({
            type: "GET",
            url: '/user/get-bookings-user',
            success: function (rooms) {

                let html = '<table id="myTable" border="1" cellspacing="0" cellpadding="5" class="table"><thead>\n' +
                    '    <tr>\n' +
                    '        <th scope="col">Mã</th>\n' +
                    '        <th scope="col">Số phòng</th>\n' +
                    '        <th scope="col">Checkin</th>\n' +
                    '        <th scope="col">Checkout</th>\n' +
                    '        <th scope="col">Số đêm</th>\n' +
                    '        <th scope="col">Tổng tiền</th>\n' +
                    '        <th scope="col">Thao tác</th>\n' +
                    '    </tr>\n' +
                    '    </thead><tbody>';
                rooms.forEach(function (b) {

                    const checkIn = formatDateTime(b.checkInDate);
                    const checkOut = formatDateTime(b.checkOutDate);
                    const nights = computeNights(b.checkInDate, b.checkOutDate);
                    // room price may be nested under b.room.price
                    const roomPrice = (b.room && b.room.price) ? b.room.price : null;
                    let total = '';
                    if (nights && roomPrice) {
                        total = new Intl.NumberFormat('vi-VN').format(nights * roomPrice) + 'đ';
                    }
                    html += `<tr>
                            <td >${b.code}</td>
                            <td>${b.room.numberRoom}</td>
                            <td>${checkIn}</td>
                            <td>${checkOut}</td>
                            <td>${nights}</td>
                            <td>${total}</td>
                            <td><button class="btn btn-primary" id="modalUpdate" onclick="showUpdateModal(${b.id})">Update</button></td>
                         </tr>`;
                })
                html += '</tbody></table>';
                $("#content").html(html);
                let table = new DataTable('#myTable');
            }
        })
    }

    function formatDateTime(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        if (isNaN(date)) return dateString; // nếu lỗi parse thì trả lại nguyên bản

        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');

        return `${hours}:${minutes}:${seconds}, ${year}/${month}/${day}`;
    }

    function computeNights(checkIn, checkOut) {
        try {
            const d1 = new Date(checkIn);
            const d2 = new Date(checkOut);
            if (isNaN(d1) || isNaN(d2)) return '';
            const diff = Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
            return diff > 0 ? diff : '';
        } catch (e) {
            return '';
        }
    }

    loadData()
</script>
<style>
    #bookingHistoryTable {
        color: #212529 !important; /* Màu chữ đen nhạt mặc định Bootstrap */
        background-color: #fff !important;
    }

    /* Header của bảng: nền sáng, chữ đen */
    #bookingHistoryTable thead {
        background-color: #f8f9fa !important;
        color: #212529 !important;
    }

    /* Dòng dữ liệu bình thường */
    #bookingHistoryTable tbody tr {
        background-color: #ffffff !important;
    }

    /* Dòng hover */
    #bookingHistoryTable tbody tr:hover {
        background-color: #e9f5ff !important; /* Màu xanh nhạt khi hover */
    }

    /* Chữ trong card body và toàn bộ trang */
    .card, .card-body, .container {
        color: #212529 !important;
    }

</style>
</body>
</html>
